# GitHub åŒæ­¥å·¥ä½œåŸç†è¯¦è§£

## ğŸ“¦ æ•°æ®å­˜å‚¨ä½ç½®

### åŒé‡å­˜å‚¨æœºåˆ¶

æ•°æ®é‡‡ç”¨**åŒé‡å­˜å‚¨**ç­–ç•¥ï¼š

1. **æœ¬åœ°å­˜å‚¨ï¼ˆlocalStorageï¼‰**
   - ä½ç½®ï¼šæµè§ˆå™¨æœ¬åœ°å­˜å‚¨
   - ç”¨é€”ï¼šå¿«é€Ÿè®¿é—®ï¼Œç¦»çº¿å¯ç”¨
   - æ ¼å¼ï¼šJSON æ•°æ®ï¼Œåˆ†åˆ«å­˜å‚¨ä¸ºï¼š
     - `life-tracker-settings`
     - `life-tracker-wish-lists`
     - `life-tracker-daily-records`

2. **GitHub å­˜å‚¨ï¼ˆå¯é€‰ï¼‰**
   - ä½ç½®ï¼šGitHub ä»“åº“ä¸­çš„ JSON æ–‡ä»¶
   - ç”¨é€”ï¼šå¤‡ä»½ã€è·¨è®¾å¤‡åŒæ­¥ã€ç‰ˆæœ¬å†å²
   - æ ¼å¼ï¼šå•ä¸ª JSON æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰æ•°æ®

### ä»“åº“é€‰æ‹©

ä½ å¯ä»¥é€‰æ‹©ï¼š

#### é€‰é¡¹ 1ï¼šä½¿ç”¨ç°æœ‰ä»“åº“ï¼ˆæ¨èï¼‰
```
ä¾‹å¦‚ï¼šyiranzhimo/Lifetime
æ–‡ä»¶è·¯å¾„ï¼šdata/life-tracker.json
```
- âœ… æ•°æ®æ–‡ä»¶ä¼šä¿å­˜åœ¨ä½ ç°æœ‰çš„ä»“åº“ä¸­
- âœ… ä¸éœ€è¦åˆ›å»ºæ–°ä»“åº“
- âœ… å¯ä»¥å’Œå…¶ä»–é¡¹ç›®æ–‡ä»¶å…±å­˜

#### é€‰é¡¹ 2ï¼šåˆ›å»ºä¸“ç”¨æ•°æ®ä»“åº“
```
ä¾‹å¦‚ï¼šyiranzhimo/life-tracker-data
æ–‡ä»¶è·¯å¾„ï¼šlife-tracker.json
```
- âœ… ä¸“é—¨ç”¨äºå­˜å‚¨æ•°æ®
- âœ… ä»“åº“æ›´ç®€æ´
- âœ… å¯ä»¥è®¾ç½®ä¸ºç§æœ‰ä»“åº“

## ğŸ”„ åŒæ­¥æµç¨‹

### æ•°æ®ä¿å­˜æµç¨‹

```
ç”¨æˆ·ä¿®æ”¹æ•°æ®
    â†“
ä¿å­˜åˆ° localStorageï¼ˆç«‹å³ï¼‰
    â†“
æ£€æŸ¥æ˜¯å¦é…ç½®äº† GitHub
    â†“
æ˜¯ â†’ è‡ªåŠ¨æ¨é€åˆ° GitHub ä»“åº“
    â†“
GitHub ä»“åº“ä¸­çš„ JSON æ–‡ä»¶æ›´æ–°
```

### ä»£ç å®ç°

```typescript
// ä¿å­˜è®¾ç½®æ—¶
const saveSettings = async (newSettings: UserSettings) => {
  // 1. æ›´æ–°æœ¬åœ°çŠ¶æ€
  const updated = { ...settings, ...newSettings };
  setSettingsState(updated);
  
  // 2. ä¿å­˜åˆ° localStorage
  saveData('settings', updated);
  
  // 3. å¦‚æœé…ç½®äº† GitHubï¼Œè‡ªåŠ¨åŒæ­¥
  if (getGitHubConfig()) {
    await syncToGitHub();  // è‡ªåŠ¨æ¨é€åˆ° GitHub
  }
};
```

### åŒæ­¥åˆ° GitHub çš„æ­¥éª¤

```typescript
// syncToGitHub å‡½æ•°çš„å·¥ä½œæµç¨‹
1. ä» localStorage è¯»å–æ‰€æœ‰æ•°æ®
2. åˆå¹¶ä¸ºå•ä¸ª JSON å¯¹è±¡
3. è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²
4. ç¼–ç ä¸º Base64ï¼ˆGitHub API è¦æ±‚ï¼‰
5. è°ƒç”¨ GitHub REST API ä¸Šä¼ æ–‡ä»¶
6. ä¿å­˜æ–‡ä»¶çš„ SHAï¼ˆç”¨äºåç»­æ›´æ–°ï¼‰
```

## ğŸ“ æ•°æ®æ–‡ä»¶ç»“æ„

### GitHub ä»“åº“ä¸­çš„æ–‡ä»¶

æ•°æ®ä»¥å•ä¸ª JSON æ–‡ä»¶å½¢å¼å­˜å‚¨ï¼š

```json
{
  "settings": {
    "birthday": "1998-09-29",
    "lifeExpectancy": 80
  },
  "wishLists": [
    {
      "id": "...",
      "name": "2024å¹´æ„¿æœ›",
      "items": [...]
    }
  ],
  "dailyRecords": [
    {
      "date": "2024-01-31",
      "content": "..."
    }
  ],
  "exportDate": "2024-01-31T12:00:00.000Z"
}
```

### æ–‡ä»¶è·¯å¾„ç¤ºä¾‹

æ ¹æ®ä½ çš„é…ç½®ï¼Œæ–‡ä»¶å¯èƒ½ä½äºï¼š

- `data/life-tracker.json`ï¼ˆé»˜è®¤ï¼‰
- `backups/life-tracker.json`
- `life-tracker.json`ï¼ˆä»“åº“æ ¹ç›®å½•ï¼‰
- ä»»ä½•ä½ æŒ‡å®šçš„è·¯å¾„

## ğŸ” é…ç½®å­˜å‚¨

### GitHub é…ç½®å­˜å‚¨ä½ç½®

é…ç½®ä¿¡æ¯å­˜å‚¨åœ¨æµè§ˆå™¨çš„ localStorage ä¸­ï¼š

```typescript
// é…ç½®é”®å
'life-tracker-github-config'  // å­˜å‚¨ GitHub é…ç½®
'life-tracker-github-sha'     // å­˜å‚¨æ–‡ä»¶ SHAï¼ˆç”¨äºæ›´æ–°ï¼‰

// é…ç½®å†…å®¹
{
  owner: 'yiranzhimo',
  repo: 'Lifetime',
  path: 'data/life-tracker.json',
  token: 'ghp_xxxxxxxxxxxx',
  branch: 'main'
}
```

**é‡è¦**ï¼šToken åªå­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚

## ğŸŒ GitHub API è°ƒç”¨

### ä½¿ç”¨çš„ API ç«¯ç‚¹

1. **è·å–æ–‡ä»¶å†…å®¹**
   ```
   GET https://api.github.com/repos/{owner}/{repo}/contents/{path}
   ```
   - ç”¨äºä» GitHub æ‹‰å–æ•°æ®

2. **åˆ›å»º/æ›´æ–°æ–‡ä»¶**
   ```
   PUT https://api.github.com/repos/{owner}/{repo}/contents/{path}
   ```
   - ç”¨äºæ¨é€æ•°æ®åˆ° GitHub
   - å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œä¼šæ›´æ–°ï¼›ä¸å­˜åœ¨ï¼Œä¼šåˆ›å»º

3. **éªŒè¯ä»“åº“è®¿é—®**
   ```
   GET https://api.github.com/repos/{owner}/{repo}
   ```
   - ç”¨äºéªŒè¯ Token å’Œæƒé™

### API è®¤è¯

ä½¿ç”¨ Personal Access Token è¿›è¡Œè®¤è¯ï¼š

```typescript
headers: {
  'Authorization': `token ${config.token}`,
  'Accept': 'application/vnd.github.v3+json',
}
```

## ğŸ“Š æ•°æ®åŒæ­¥ç¤ºä¾‹

### åœºæ™¯ 1ï¼šé¦–æ¬¡é…ç½®

1. ç”¨æˆ·åœ¨åº”ç”¨ä¸­é…ç½® GitHub ä¿¡æ¯
2. ç‚¹å‡»"æ¨é€åˆ° GitHub"
3. ç³»ç»Ÿä» localStorage è¯»å–æ‰€æœ‰æ•°æ®
4. åˆå¹¶ä¸º JSON å¹¶ä¸Šä¼ åˆ° GitHub
5. GitHub ä»“åº“ä¸­åˆ›å»ºæ–°æ–‡ä»¶ï¼š`data/life-tracker.json`

### åœºæ™¯ 2ï¼šè‡ªåŠ¨åŒæ­¥

1. ç”¨æˆ·ä¿®æ”¹äº†æ„¿æœ›æ¸…å•
2. æ•°æ®ä¿å­˜åˆ° localStorage
3. ç³»ç»Ÿæ£€æµ‹åˆ°å·²é…ç½® GitHub
4. è‡ªåŠ¨è°ƒç”¨ `syncToGitHub()`
5. æ•°æ®æ¨é€åˆ° GitHubï¼Œæ–‡ä»¶æ›´æ–°

### åœºæ™¯ 3ï¼šè·¨è®¾å¤‡åŒæ­¥

**è®¾å¤‡ Aï¼ˆä¸»è®¾å¤‡ï¼‰**
1. ä¿®æ”¹æ•°æ® â†’ è‡ªåŠ¨åŒæ­¥åˆ° GitHub

**è®¾å¤‡ Bï¼ˆæ–°è®¾å¤‡ï¼‰**
1. é…ç½®ç›¸åŒçš„ GitHub ä¿¡æ¯
2. ç‚¹å‡»"ä» GitHub æ‹‰å–"
3. ç³»ç»Ÿä» GitHub ä¸‹è½½æ•°æ®
4. å¯¼å…¥åˆ° localStorage
5. ä¹‹åä¿®æ”¹ä¹Ÿä¼šè‡ªåŠ¨åŒæ­¥

## ğŸ” æ–‡ä»¶æ›´æ–°æœºåˆ¶

### SHA å€¼çš„ä½œç”¨

GitHub ä½¿ç”¨ SHA å€¼æ¥è·Ÿè¸ªæ–‡ä»¶ç‰ˆæœ¬ï¼š

```typescript
// é¦–æ¬¡ä¸Šä¼ ï¼ˆåˆ›å»ºæ–‡ä»¶ï¼‰
await putGitHubFile(config, data);  // ä¸æä¾› SHA

// åç»­æ›´æ–°ï¼ˆæ›´æ–°æ–‡ä»¶ï¼‰
await putGitHubFile(config, data, sha);  // æä¾› SHA
```

- æä¾› SHAï¼šæ›´æ–°ç°æœ‰æ–‡ä»¶
- ä¸æä¾› SHAï¼šåˆ›å»ºæ–°æ–‡ä»¶

### å†²çªå¤„ç†

å¦‚æœå¤šä¸ªè®¾å¤‡åŒæ—¶ä¿®æ”¹ï¼š

1. **æœ€åå†™å…¥è·èƒœ**ï¼šæœ€ååŒæ­¥çš„æ•°æ®ä¼šè¦†ç›–ä¹‹å‰çš„
2. **å»ºè®®**ï¼šåœ¨ä¸åŒè®¾å¤‡ä¸Šä½¿ç”¨å‰ï¼Œå…ˆæ‹‰å–æœ€æ–°æ•°æ®

## ğŸ’¾ å­˜å‚¨ä½ç½®æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµè§ˆå™¨ localStorage                 â”‚
â”‚  â”œâ”€ life-tracker-settings           â”‚
â”‚  â”œâ”€ life-tracker-wish-lists        â”‚
â”‚  â”œâ”€ life-tracker-daily-records      â”‚
â”‚  â”œâ”€ life-tracker-github-config     â”‚ â† GitHub é…ç½®
â”‚  â””â”€ life-tracker-github-sha        â”‚ â† æ–‡ä»¶ç‰ˆæœ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ è‡ªåŠ¨åŒæ­¥ï¼ˆå¦‚æœå·²é…ç½®ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub ä»“åº“                        â”‚
â”‚  â””â”€ data/life-tracker.json         â”‚ â† æ‰€æœ‰æ•°æ®çš„å¤‡ä»½
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å…³é”®ç‚¹æ€»ç»“

1. **ä¸æ˜¯æ–°ä»“åº“**ï¼šå¯ä»¥ä½¿ç”¨ç°æœ‰ä»“åº“ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæ–°ä»“åº“
2. **æ•°æ®æ–‡ä»¶**ï¼šæ‰€æœ‰æ•°æ®åˆå¹¶ä¸ºä¸€ä¸ª JSON æ–‡ä»¶å­˜å‚¨åœ¨ä»“åº“ä¸­
3. **è‡ªåŠ¨åŒæ­¥**ï¼šé…ç½®åï¼Œæ¯æ¬¡ä¿å­˜è‡ªåŠ¨æ¨é€åˆ° GitHub
4. **åŒé‡å­˜å‚¨**ï¼šæ•°æ®åŒæ—¶ä¿å­˜åœ¨ localStorage å’Œ GitHub
5. **ç‰ˆæœ¬å†å²**ï¼šGitHub è‡ªåŠ¨ä¿å­˜æ¯æ¬¡æ›´æ–°çš„å†å²è®°å½•
6. **å®‰å…¨**ï¼šToken åªå­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œä¸ä¼šæ³„éœ²

## ğŸ”— ç›¸å…³ä»£ç æ–‡ä»¶

- `src/utils/githubSync.ts` - GitHub API è°ƒç”¨
- `src/hooks/useStorage.ts` - å­˜å‚¨å’ŒåŒæ­¥é€»è¾‘
- `src/components/DataManager.tsx` - é…ç½®ç•Œé¢

